<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø´ØºÙ„ Ø£Ù„Ø¹Ø§Ø¨ Ø²ÙŠÙ† | Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</title>
    <style>
        :root { 
            --primary: #adff2f; 
            --accent: #bf5af2; 
            --bg: #0a0a0c;
        }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--bg); overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .header-controls {
            height: 60px; background: #111; 
            display: flex; justify-content: space-between;
            align-items: center; padding: 0 20px;
            border-bottom: 2px solid #222;
            z-index: 10;
        }

        .btn {
            background: #1a1a1a; border: 2px solid var(--primary);
            color: var(--primary); padding: 8px 20px; border-radius: 12px;
            cursor: pointer; font-weight: bold; transition: 0.3s;
            text-transform: uppercase; font-size: 0.8rem;
        }
        .btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ */
        .game-viewport {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¥Ø·Ø§Ø± ÙˆØ­ÙˆØ§Ù Ø§Ù„Ù…ØªØµÙØ­ */
            position: relative;
        }

        /* Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù†ÙŠÙˆÙ† Ø§Ù„Ù…Ù„ÙˆÙ† */
        .neon-frame {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 1200px; /* Ø£Ù‚ØµÙ‰ Ø¹Ø±Ø¶ Ù„Ù„Ø¥Ø·Ø§Ø± Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ù‚Ø© */
            max-height: 85vh;
            background: #000;
            border-radius: 25px;
            padding: 10px; /* Ø³Ù…Ùƒ Ø§Ù„Ø¥Ø·Ø§Ø± */
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            /* ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬ Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
            background: linear-gradient(45deg, var(--primary), var(--accent), var(--primary));
            background-size: 400% 400%;
            animation: gradient-border 8s ease infinite;
        }

        @keyframes gradient-border {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© (Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø±) */
        .inner-screen {
            width: 100%;
            height: 100%;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        #gameFrame { 
            width: 100%; 
            height: 100%; 
            border: none; 
            display: block;
        }

        #codeStorage { display: none; }

        @media (max-width: 600px) {
            .game-viewport { padding: 10px; }
            .neon-frame { border-radius: 15px; padding: 5px; }
        }
    </style>
</head>
<body>

    <div class="header-controls">
        <button class="btn" onclick="window.location.href='index.html'">â†©ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        <div style="color: #fff; font-family: monospace; font-size: 1rem; font-weight: bold;">
            ZEN <span style="color:var(--primary)">GAME</span> BOX
        </div>
        <button class="btn" style="border-color: var(--accent); color: var(--accent);" onclick="toggleFS()">ğŸ“º Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>
    </div>

    <div class="game-viewport">
        <div class="neon-frame" id="mainFrame">
            <div class="inner-screen">
                <iframe id="gameFrame" allow="autoplay; fullscreen; pointer-lock" scrolling="no"></iframe>
            </div>
        </div>
    </div>

    <textarea id="codeStorage">
      <!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>NEON VOID - Final Edition</title>
<style>
    body { margin: 0; overflow: hidden; background: #000; user-select: none; touch-action: none; font-family: 'Orbitron', sans-serif; }
    canvas { display: block; cursor: crosshair; }
    #ui { position: absolute; top: 10px; left: 10px; pointer-events: none; color: #fff; z-index: 10; }
    .hud-bar { height: 6px; background: rgba(255,255,255,0.1); margin-top: 4px; width: 140px; border-radius: 3px; overflow: hidden; }
    .hud-fill { height: 100%; transition: width 0.3s; box-shadow: 0 0 10px currentColor; }
    #overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; }
    h1 { font-size: 3rem; color: #ff00ff; text-shadow: 0 0 20px #ff00ff; margin-bottom: 0; }
    .btn-start { margin-top: 2rem; padding: 1rem 3rem; background: none; border: 2px solid #00f2fe; color: #00f2fe; font-size: 1.2rem; cursor: pointer; border-radius: 50px; box-shadow: 0 0 15px #00f2fe; font-weight: bold; pointer-events: auto; }
    #joystick-zone { position: absolute; bottom: 40px; left: 40px; width: 110px; height: 110px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255,0,255,0.4); border-radius: 50%; display: none; }
    #joystick-knob { width: 45px; height: 45px; background: #ff00ff; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 10px #ff00ff; }
    #dash-btn { position: absolute; bottom: 50px; right: 40px; width: 80px; height: 80px; background: rgba(0, 242, 254, 0.1); border: 2px solid #00f2fe; border-radius: 50%; color: #fff; display: flex; justify-content: center; align-items: center; font-weight: bold; cursor: pointer; pointer-events: auto; }
    .status-msg { position: absolute; top: 20%; width: 100%; text-align: center; color: #ffeb3b; font-size: 1.5rem; text-shadow: 0 0 10px #ffeb3b; pointer-events: none; opacity: 0; transition: 0.5s; }
</style>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
</head>
<body>

<div id="ui">
    <div style="font-size: 18px; letter-spacing: 2px;">SCORE: <span id="scoreVal">0</span></div>
    <div style="color: #ffeb3b;">LEVEL: <span id="lvlVal">1</span></div>
    <div class="hud-bar"><div id="hpBar" class="hud-fill" style="background: #00ff88; width: 100%;"></div></div>
    <div class="hud-bar"><div id="energyBar" class="hud-fill" style="background: #ff00ff; width: 0%;"></div></div>
</div>

<div id="status" class="status-msg">LEVEL UP!</div>

<div id="overlay">
    <h1 id="mainTitle">NEON VOID</h1>
    <p style="color: #666; letter-spacing: 3px;">MOVE MOUSE TO STEER & AIM</p>
    <button class="btn-start" onclick="startGame()">ENGAGE SYSTEM</button>
</div>

<div id="joystick-zone"><div id="joystick-knob"></div></div>
<div id="dash-btn" onmousedown="tryDash(event)" ontouchstart="tryDash(event)">DASH</div>

<canvas id="c"></canvas>

<script>
const c = document.getElementById('c'), ctx = c.getContext('2d');
let w, h, frame = 0, score = 0, level = 1, shake = 0, state = 'menu';
let player, enemies, bullets, particles, items, boss;
let mouse = { x: 0, y: 0 };
let isTouch = false;
let joyData = { active: false, dx: 0, dy: 0 };

const levelConfigs = [
    { req: 1000, color: '#00f2fe', bossHp: 40 },
    { req: 5000, color: '#bd00ff', bossHp: 80 },
    { req: 15000, color: '#ffeb3b', bossHp: 150 },
    { req: 40000, color: '#ff0000', bossHp: 500 }
];

function resize() { w = c.width = window.innerWidth; h = c.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

// --- Controls ---
window.addEventListener('touchstart', () => { 
    isTouch = true; 
    document.getElementById('joystick-zone').style.display = 'block';
});
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
window.addEventListener('contextmenu', e => { e.preventDefault(); tryDash(); });

const joyZone = document.getElementById('joystick-zone'), joyKnob = document.getElementById('joystick-knob');
joyZone.addEventListener('touchstart', e => { joyData.active = true; updateJoy(e); }, {passive: false});
window.addEventListener('touchmove', e => { if(joyData.active) { updateJoy(e); e.preventDefault(); } }, {passive: false});
window.addEventListener('touchend', () => { joyData.active = false; joyData.dx = 0; joyData.dy = 0; joyKnob.style.transform = `translate(-50%,-50%)`; });

function updateJoy(e) {
    const t = e.touches[0];
    const r = joyZone.getBoundingClientRect(), cx = r.left+r.width/2, cy = r.top+r.height/2;
    const dist = Math.min(Math.hypot(t.clientX-cx, t.clientY-cy), r.width/2), ang = Math.atan2(t.clientY-cy, t.clientX-cx);
    joyData.dx = Math.cos(ang)*(dist/(r.width/2)); 
    joyData.dy = Math.sin(ang)*(dist/(r.width/2));
    joyKnob.style.transform = `translate(calc(-50% + ${Math.cos(ang)*dist}px), calc(-50% + ${Math.sin(ang)*dist}px))`;
}

function tryDash(e) {
    if(e) e.preventDefault();
    if(player && player.energy >= 100) {
        player.energy = 0; shake = 30;
        let ang = Math.atan2(mouse.y - player.y, mouse.x - player.x);
        if(isTouch && (joyData.dx !== 0 || joyData.dy !== 0)) ang = Math.atan2(joyData.dy, joyData.dx);
        player.x += Math.cos(ang) * 180;
        player.y += Math.sin(ang) * 180;
        for(let i=0; i<40; i++) particles.push(new Particle(player.x, player.y, '#00f2fe', 10));
    }
}

function startGame() {
    state = 'playing'; score = 0; level = 1; boss = null; frame = 0;
    player = { x: w/2, y: h/2, hp: 100, energy: 0, weapon: 'single', weaponTimer: 0, radius: 15, color: '#ff00ff' };
    enemies = []; bullets = []; particles = []; items = [];
    document.getElementById('overlay').style.display = 'none';
}

class Particle {
    constructor(x, y, color, speed=3) {
        this.x = x; this.y = y; this.color = color;
        let a = Math.random()*Math.PI*2, s = Math.random()*speed;
        this.vx = Math.cos(a)*s; this.vy = Math.sin(a)*s;
        this.life = 1; this.decay = Math.random()*0.04+0.02;
    }
    update() { this.x += this.vx; this.y += this.vy; this.life -= this.decay; }
    draw() { ctx.globalAlpha = this.life; ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, 2, 2); ctx.globalAlpha = 1; }
}

class Enemy {
    constructor(isBoss = false) {
        this.isBoss = isBoss;
        let ang = Math.random()*Math.PI*2, d = Math.max(w,h)+100;
        this.x = w/2 + Math.cos(ang)*d; this.y = h/2 + Math.sin(ang)*d;
        this.hp = isBoss ? levelConfigs[level-1].bossHp : level * 2;
        this.size = isBoss ? 60 : 18;
        this.speed = isBoss ? 1.5 : 2 + (level * 0.3);
        this.color = isBoss ? '#ff0055' : levelConfigs[level-1].color;
    }
    update() {
        let a = Math.atan2(player.y-this.y, player.x-this.x);
        this.x += Math.cos(a)*this.speed; this.y += Math.sin(a)*this.speed;
        if(this.isBoss && frame % 40 === 0) {
            for(let i=0; i<8; i++) spawnEnemyBullet(this.x, this.y, (Math.PI*2/8)*i + frame*0.02);
        }
    }
    draw() {
        ctx.shadowBlur = this.isBoss ? 25 : 10; ctx.shadowColor = this.color;
        ctx.fillStyle = this.color;
        if(this.isBoss) {
            ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(frame*0.02);
            ctx.fillRect(-this.size, -this.size, this.size*2, this.size*2); ctx.restore();
        } else {
            ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill();
        }
        ctx.shadowBlur = 0;
    }
}

function spawnEnemyBullet(x, y, ang) {
    bullets.push({x, y, vx: Math.cos(ang)*5, vy: Math.sin(ang)*5, type: 'enemy', life: 140});
}

function shoot() {
    let ang = Math.atan2(mouse.y - player.y, mouse.x - player.x);
    if(isTouch && (joyData.dx !== 0 || joyData.dy !== 0)) ang = Math.atan2(joyData.dy, joyData.dx);
    const speed = 15;
    if(player.weapon === 'single') {
        bullets.push({x:player.x, y:player.y, vx:Math.cos(ang)*speed, vy:Math.sin(ang)*speed, type:'player', life:80});
    } else if(player.weapon === 'triple') {
        for(let a of [-0.25, 0, 0.25]) 
            bullets.push({x:player.x, y:player.y, vx:Math.cos(ang+a)*speed, vy:Math.sin(ang+a)*speed, type:'player', life:80});
    } else if(player.weapon === 'laser') {
        bullets.push({x:player.x, y:player.y, vx:Math.cos(ang)*25, vy:Math.sin(ang)*25, type:'player', color:'#00f2fe', life:40});
    }
    if(player.weaponTimer > 0) { player.weaponTimer--; if(player.weaponTimer<=0) player.weapon = 'single'; }
}

function loop() {
    requestAnimationFrame(loop);
    ctx.fillStyle = 'rgba(0,0,0,0.2)'; ctx.fillRect(0,0,w,h);

    if(state === 'playing') {
        frame++;
        
        // Player Movement
        let oldX = player.x, oldY = player.y;
        if(isTouch) {
            player.x += joyData.dx * 8; player.y += joyData.dy * 8;
        } else {
            let dx = mouse.x - player.x, dy = mouse.y - player.y, dist = Math.hypot(dx, dy);
            if(dist > 5) { player.x += (dx / dist) * 8; player.y += (dy / dist) * 8; }
        }
        player.x = Math.max(20, Math.min(w-20, player.x)); player.y = Math.max(20, Math.min(h-20, player.y));

        // Thruster Particles (ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø­Ø±Ùƒ)
        if(frame % 2 === 0) particles.push(new Particle(player.x, player.y, player.color, 2));

        if(frame % 10 === 0) shoot();
        if(frame % 100 === 0 && !boss) enemies.push(new Enemy(false));

        // Update Bullets
        for(let i=bullets.length-1; i>=0; i--) {
            let b = bullets[i]; b.x += b.vx; b.y += b.vy; b.life--;
            ctx.fillStyle = b.type === 'player' ? (b.color || '#fff') : '#ff0055';
            ctx.beginPath(); ctx.arc(b.x, b.y, b.type==='player'?4:6, 0, Math.PI*2); ctx.fill();
            if(b.life<=0) bullets.splice(i,1);
            else if(b.type === 'enemy' && Math.hypot(b.x-player.x, b.y-player.y)<20) {
                player.hp -= 10; shake = 15; bullets.splice(i,1);
            }
        }

        // Update Enemies
        let currentConfig = levelConfigs[level-1];
        if(score >= currentConfig.req && !boss && level < 4) {
            boss = new Enemy(true); enemies.push(boss); showStatus("BOSS INBOUND!");
        }

        for(let i=enemies.length-1; i>=0; i--) {
            let e = enemies[i]; e.update(); e.draw();
            if(Math.hypot(e.x-player.x, e.y-player.y) < e.size+15) {
                player.hp -= 1; shake = 5;
            }
            for(let j=bullets.length-1; j>=0; j--) {
                let b = bullets[j];
                if(b.type === 'player' && Math.hypot(e.x-b.x, e.y-b.y) < e.size+5) {
                    e.hp--; bullets.splice(j,1);
                    if(e.hp<=0) {
                        if(e.isBoss) { level++; boss = null; score += 5000; showStatus("LEVEL UP!"); }
                        score += 100; player.energy = Math.min(100, player.energy+8);
                        for(let k=0; k<15; k++) particles.push(new Particle(e.x, e.y, e.color));
                        enemies.splice(i,1); break;
                    }
                }
            }
        }

        // Update Items
        if(frame % 800 === 0) items.push({x: Math.random()*(w-60)+30, y: Math.random()*(h-60)+30, type: Math.random()>0.5?'triple':'laser'});
        for(let i=items.length-1; i>=0; i--) {
            let it = items[i];
            ctx.fillStyle = '#ffeb3b'; ctx.shadowBlur = 15; ctx.shadowColor = '#ffeb3b';
            ctx.font = 'bold 20px Orbitron'; ctx.fillText("âš¡", it.x, it.y);
            if(Math.hypot(it.x-player.x, it.y-player.y)<30) {
                player.weapon = it.type; player.weaponTimer = 350; items.splice(i,1);
            }
        }

        // Final Player Render (Pink Circle)
        ctx.shadowBlur = 20; ctx.shadowColor = player.color;
        ctx.fillStyle = player.color;
        ctx.beginPath(); ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2); ctx.fill();
        ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();
        ctx.shadowBlur = 0;

        if(player.hp <= 0) { 
            state = 'menu'; 
            document.getElementById('overlay').style.display = 'flex'; 
            document.getElementById('mainTitle').innerText = "SYSTEM CRASH"; 
        }
        
        document.getElementById('scoreVal').innerText = score;
        document.getElementById('lvlVal').innerText = level;
        document.getElementById('hpBar').style.width = player.hp + "%";
        document.getElementById('energyBar').style.width = player.energy + "%";
    }

    particles.forEach((p, i) => { p.update(); p.draw(); if(p.life<=0) particles.splice(i,1); });
    if(shake > 0) { ctx.setTransform(1,0,0,1, (Math.random()-0.5)*shake, (Math.random()-0.5)*shake); shake *= 0.9; }
    else ctx.setTransform(1,0,0,1,0,0);
}

function showStatus(txt) {
    let el = document.getElementById('status');
    el.innerText = txt; el.style.opacity = 1;
    setTimeout(() => el.style.opacity = 0, 2000);
}

loop();
</script>
</body>
</html>
        </textarea>

    <script>
        function loadGame() {
            const frame = document.getElementById('gameFrame');
            const code = document.getElementById('codeStorage').value;
            const frameDoc = frame.contentWindow.document;
            frameDoc.open();
            frameDoc.write(`
                <style>
                    body, html { margin: 0; padding: 0; overflow: hidden; width: 100vw; height: 100vh; background: #000; }
                    canvas { width: 100% !important; height: 100% !important; object-fit: contain; }
                </style>
                ${code}
            `);
            frameDoc.close();
        }

        function toggleFS() {
            const container = document.getElementById("mainFrame");
            if (!document.fullscreenElement) {
                container.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        window.onload = loadGame;
    </script>
</body>
</html>
